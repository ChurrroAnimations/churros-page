<!DOCTYPE html>
<html>
    <head>
        <title>
            Churro's Website ~ Brainf*ck Compiler
        </title>
        <link rel="stylesheet" href="3D_Game_Class.css">
        <link rel="icon" href="Resources/Page_Elements/Churro_Page_Icon.svg">

        <!-- Link Embedding -->
        <meta charset="utf-8" />
        <meta property="og:site_name" content="Churro's Website ~ Brainf*ck" />
        <meta property="og:title" content="Churro's Website ~ Brainf*ck" />
        <meta name="description" content="This is the Brainf*ck compiler page for Churro's website." />
        <meta property="og:description" content="This is the Brainf*ck compiler page Churro's website." />
        <meta property="og:type" content="website" />
        <meta property="og:image" content="https://churrroanimations.github.io/churros-page/Resources/External/embed-img.jpg" />
        <meta property="og:image:type" content="image/jpeg" />
        <meta property="og:image:width" content="1280" />
        <meta property="og:image:height" content="800" />
        <meta property="twitter:card" content="summary_large_image" />
        <meta property="og:url" content="https://churrroanimations.github.io/churros-page/brainf_ck/" />
        <link rel="canonical" href="https://churrroanimations.github.io/churros-page/brainf_ck/" />
    </head>
    <body>
        <div class="backBlur"></div>
        <p class="photoCred">
            Text Fonts: Google Fonts
            <br>
            Background: Aidan Bettis
        </p>
        <div class="primaryContainer primaryDivider">
            <!-- Header & Home Button -->
            <h1 class="sectionHeader">
                Brainf¤ck
            </h1>
            <div class="homeIconDiv">
                <a href="https://churrroanimations.github.io/churros-commissions/">
                    <img src="Resources/Page_Resources/HomeUrpl.svg" alt="Main Menu", class="homeIconImg">
                </a>
            </div>

            <!-- Info -->
            <div class="secondaryContainer" id="gameContainer">
                <h3 class="subsectionHeader">
                    Brainf*ck
                </h3>
                <canvas id="gameDisplay" width="10" height="100" class="subsectionTextarea primaryDivider">
                </canvas>
                <p id="testLoop">
                    200
                </p>
                <p id="touch">

                </p>
                <p id ="rD2p">

                </p>
                <p id="allKeysDown">

                </p>
            </div>
            <hr class="primaryDivider" style="border: 0px; margin-bottom: 1.2em;">
            <div class="primaryNestedContainer primaryDivider" style="display:none;" id="memoryDiv">
                <h2 class="subsectionHeader">
                    Memory
                </h2>
                <ul class="subsectionList">
                    <li>Data Pointer Location:</li>
                    <li id="dataPointa">1</li>
                    <li>Unused User Input Data:</li>
                    <li id="userImputVar"></li>
                </ul>
                <ul class="subsectionList" id="memoryBank">
                </ul>
            </div>
        </div>

        <!-- Scripts -->
        <script>
            /* Define da varibles */ {
                const gameContainer = document.getElementById("gameContainer");
                gameDisplay = document.getElementById("gameDisplay");
                stage = {
                    w : 480,
                    h : 360,
                    s : 600,
                    ctx : gameDisplay.getContext('2d'),
                }
                var player = {
                    display : {
                    },
                    real : {
                        x : 200,
                        y : 0,
                        d : 0,
                        s : 10,
                        turn : 3 * Math.PI ,
                        step : 2.5,
                    },
                }
                var allKeysDown = [];
                checkDisplay();

                var changeInXpos;
                var changeInYpos;

                var deltaTime = 0;
                var prevFrameTimestamp;
                var currFrameTimestamp = Date.now();

                //var inte = 200;
                requestAnimationFrame(gameTick);
            }
            /* Keys Pressed */ {
                window.onkeydown = keyPress;
                window.onkeyup = keyUnpress;
                function keyPress(keyFocus){
                    let keyDown = keyFocus.key;
                    if (keyDown.length == 1) keyDown = keyDown.toUpperCase();
                    if (keyDown == " ") keyDown = "Space";
                    if (allKeysDown.indexOf(keyDown) == -1) allKeysDown.push(keyDown);
                }
                function keyUnpress(keyFocus){
                    let keyDown = keyFocus.key;
                    if (keyDown.length == 1) keyDown = keyDown.toUpperCase();
                    if (keyDown == " ") keyDown = "Space";
                    let keyIndex = allKeysDown.indexOf(keyDown);
                    if (keyIndex > -1) allKeysDown.splice(keyIndex, 1);
                }
                function isKeyDown (keyFocus) {return (allKeysDown.indexOf(keyFocus) > -1);}
            }
            
            function getXonStage (xPos) {return (xPos / stage.w + 0.5) * gameDisplay.width;}
            function getYonStage (yPos) {return (yPos * -1 / stage.h + 0.5) * gameDisplay.height;}
            function checkDisplay () {
                gameDisplay.width = gameContainer.offsetWidth;
                gameDisplay.height = gameContainer.offsetWidth / 4 * 3;
            }

            function drawRect (x1, y1, x2, y2) {
                stage.ctx.moveTo(
                    getXonStage(x1),
                    getYonStage(y1),
                );
                stage.ctx.lineTo(
                    getXonStage(x2),
                    getYonStage(y1),
                );
                stage.ctx.moveTo(
                    getXonStage(x2),
                    getYonStage(y1),
                );
                stage.ctx.lineTo(
                    getXonStage(x2),
                    getYonStage(y2),
                );
                stage.ctx.moveTo(
                    getXonStage(x2),
                    getYonStage(y2),
                );
                stage.ctx.lineTo(
                    getXonStage(x1),
                    getYonStage(y2),
                );
                stage.ctx.moveTo(
                    getXonStage(x1),
                    getYonStage(y2),
                );
                stage.ctx.lineTo(
                    getXonStage(x1),
                    getYonStage(y1),
                );

                stage.ctx.moveTo(
                    getXonStage(x1),
                    getYonStage(y1),
                );
                stage.ctx.lineTo(
                    getXonStage(x2),
                    getYonStage(y2),
                );
                stage.ctx.moveTo(
                    getXonStage(x2),
                    getYonStage(y1),
                );
                stage.ctx.lineTo(
                    getXonStage(x1),
                    getYonStage(y2),
                )

                let xMax = x1 > x2 ? x1 : x2;
                let xMin = x1 < x2 ? x1 : x2;
                let xMid = (xMin + xMax) / 2;
                let yMax = y1 > y2 ? y1 : y2;
                let yMin = y1 < y2 ? y1 : y2;
                let yMid = (yMin + yMax) / 2;

                let playerCurPosX = player.real.x;
                let playerCurPosY = player.real.y;
                let playerOldPosX = playerCurPosX - changeInXpos;
                let playerOldPosY = playerCurPosY - changeInYpos;

                let xOff = playerOldPosX - xMid;
                let yOff = playerOldPosY - yMid;
                let dirRectToPlayer = Math.atan2(yOff, xOff);


                /* Collision */ if (
                    xMax + player.real.s > playerCurPosX &&
                    xMin - player.real.s < playerCurPosX &&
                    yMax + player.real.s > playerCurPosY &&
                    yMin - player.real.s < playerCurPosY
                ) {
                    if (playerCurPosX === xMid && playerCurPosY === yMid) {
                        player.real.x = playerOldPosX;
                        player.real.y = playerOldPosY;
                        return;
                    }
                    document.getElementById("touch").innerHTML = 3 * Math.PI / 4;
                    if (Math.abs(dirRectToPlayer) < Math.PI / 4 && yMax > playerCurPosY && playerCurPosY > yMin && xMax + player.real.s > playerCurPosX) player.real.x = xMax + player.real.s;
                    else if (Math.abs(dirRectToPlayer) > 3 * Math.PI / 4 && yMax > playerCurPosY && playerCurPosY > yMin && playerCurPosX > xMin - player.real.s) player.real.x = xMin - player.real.s;
                    else if (4 * Math.PI / 4 > dirRectToPlayer && dirRectToPlayer > Math.PI / 4 && xMax > playerCurPosX && playerCurPosX > xMin && yMax + player.real.s > playerCurPosY) player.real.y = yMax + player.real.s;
                    else if (-4 * Math.PI / 4 < dirRectToPlayer && dirRectToPlayer < -1 * Math.PI / 4 && xMax > playerCurPosX && playerCurPosX > xMin && playerCurPosY > yMin - player.real.s) player.real.y = yMin - player.real.s;
                    else {
                        if (xOff > 0) xMid = xMax;
                        else xMid = xMin;
                        if (yOff > 0) yMid = yMax;
                        else yMid = yMin;
                        xOffCorner = playerOldPosX - xMid;
                        yOffCorner = playerOldPosY - yMid;
                        if (Math.sqrt(Math.pow(xOffCorner, 2) + Math.pow(yOffCorner, 2)) < 10) {
                            let xBump = 10 * Math.cos(
                                Math.atan2(yOffCorner, xOffCorner)
                            );
                            let yBump = 10 * Math.sin(
                                Math.atan2(yOffCorner, xOffCorner)
                            );
                            if (xOff > 0) player.real.x = xMid + xBump;
                            else player.real.x = xMid - xBump;
                            
                            if (yOff > 0) player.real.y = yMid + yBump;
                            else player.real.y = yMid - yBump;
                        }
                    }
                    document.getElementById("rD2p").innerHTML = dirRectToPlayer;
                    
                }
            }


            function gameTick () {
                /* Delta Time */ {
                    prevFrameTimestamp = currFrameTimestamp;
                    currFrameTimestamp = Date.now();
                    deltaTime = (currFrameTimestamp - prevFrameTimestamp) / 1000;
                }

                document.getElementById("testLoop").innerHTML = "∆t: " + deltaTime + " dir: " + player.real.d + " x: " + player.real.x + " y: " + player.real.y;
                document.getElementById("allKeysDown").innerHTML = allKeysDown.join(', ');

                checkDisplay();

                let changeInDirection = 0;
                if (isKeyDown("K")) changeInDirection += 1;
                if (isKeyDown(";")) changeInDirection -= 1;
                player.real.d = (player.real.d + changeInDirection * deltaTime * player.real.turn + 2 * Math.PI) % (2 * Math.PI);
                
                let changeInPosition = 0;
                if (isKeyDown("O")) changeInPosition += 1;
                if (isKeyDown("L")) changeInPosition -= 1;
                changeInXpos = Math.cos(player.real.d) * changeInPosition * player.real.step;
                changeInYpos = Math.sin(player.real.d) * changeInPosition * player.real.step;
                player.real.x += changeInXpos;
                player.real.y += changeInYpos;
                
                /* Draw screen */ {

                    /* Top Down Obstacles */ {
                        stage.ctx.beginPath();
                        stage.ctx.strokeStyle = "tomato";
                        stage.ctx.lineWidth = 3;

                        drawRect(100, 40, 50, -40);
                        stage.ctx.stroke();
                    }

                    /* Top Down Player */ {
                        // Hitbox
                        stage.ctx.beginPath();
                        stage.ctx.strokeStyle = "#bf99e6";
                        stage.ctx.lineWidth = 1;

                        stage.ctx.moveTo(
                            getXonStage(player.real.x + player.real.s),
                            getYonStage(player.real.y),
                        );
                        for(let dir = 0; dir < 360; dir++) {
                            stage.ctx.lineTo(
                                getXonStage(player.real.x + Math.cos(dir * Math.PI / 180) * player.real.s),
                                getYonStage(player.real.y + Math.sin(dir * Math.PI / 180) * player.real.s),
                            );
                        }
                        stage.ctx.stroke();

                        
                        // Draw Player
                        stage.ctx.beginPath();
                        stage.ctx.strokeStyle = "tomato";
                        stage.ctx.lineWidth = 3;

                        stage.ctx.moveTo(
                            getXonStage(player.real.x + Math.cos(player.real.d) * player.real.s),
                            getYonStage(player.real.y + Math.sin(player.real.d) * player.real.s),
                        );
                        stage.ctx.lineTo(
                            getXonStage(player.real.x + Math.cos(player.real.d + Math.PI) * player.real.s),
                            getYonStage(player.real.y + Math.sin(player.real.d + Math.PI) * player.real.s),
                        );
                        
                        stage.ctx.moveTo(
                            getXonStage(player.real.x + Math.cos(player.real.d + Math.PI / 2) * player.real.s),
                            getYonStage(player.real.y + Math.sin(player.real.d + Math.PI / 2) * player.real.s),
                        );
                        stage.ctx.lineTo(
                            getXonStage(player.real.x + Math.cos(player.real.d + 3 * Math.PI / 2) * player.real.s),
                            getYonStage(player.real.y + Math.sin(player.real.d + 3 * Math.PI / 2) * player.real.s)
                        );
                        
                        stage.ctx.moveTo(
                            getXonStage(player.real.x + Math.cos(player.real.d) * player.real.s),
                            getYonStage(player.real.y + Math.sin(player.real.d) * player.real.s),
                        );
                        stage.ctx.lineTo(
                            getXonStage(player.real.x + Math.cos(player.real.d + 2 * Math.PI / 3) * player.real.s),
                            getYonStage(player.real.y + Math.sin(player.real.d + 2 * Math.PI / 3) * player.real.s),
                        );
                        stage.ctx.lineTo(
                            getXonStage(player.real.x + Math.cos(player.real.d + Math.PI) * player.real.s),
                            getYonStage(player.real.y + Math.sin(player.real.d + Math.PI) * player.real.s),
                        );
                        stage.ctx.lineTo(
                            getXonStage(player.real.x + Math.cos(player.real.d + 4 * Math.PI / 3) * player.real.s),
                            getYonStage(player.real.y + Math.sin(player.real.d + 4 * Math.PI / 3) * player.real.s),
                        );
                        stage.ctx.lineTo(
                            getXonStage(player.real.x + Math.cos(player.real.d) * player.real.s),
                            getYonStage(player.real.y + Math.sin(player.real.d) * player.real.s),
                        );
                        
                        stage.ctx.stroke();
                        
                    }

                }
                
                //inte--;
                /*if (inte > 0)*/ 
                requestAnimationFrame(gameTick);
            }
        </script>
    </body>
</html>